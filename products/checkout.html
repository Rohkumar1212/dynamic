<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Checkout - Dynamic Corrugations</title>
    <link href="/css/checkout.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="/images/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        document.querySelectorAll("textarea").forEach(t => {
            t.addEventListener("input", function () {
                if (this.value.trim().length > 0) {
                    this.classList.add("has-text");
                } else {
                    this.classList.remove("has-text");
                }
            });
        });
    </script>
<style>
    /* -------- Checkout Layout -------- */
    .checkout-container {
        max-width: 900px;
        margin: 20px auto;
        background: #fff;
        padding: 25px;
        border-radius: 10px;
        border: 1px solid #ddd;
    }

    .section-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 12px;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 18px;
        margin-bottom: 25px;
    }

    .form-group {
        position: relative;
    }

    .form-input {
        width: 90%;
        padding: 12px;
        border: 1px solid #bbb;
        border-radius: 6px;
        font-size: 15px;
        outline: none;
    }

    .form-input:focus {
        border-color: #4a6cf7;
        box-shadow: 0 0 4px rgba(74, 108, 247, 0.3);
    }

    .form-label {
        position: absolute;
        left: 12px;
        top: -8px;
        background: #fff;
        padding: 0 4px;
        font-size: 13px;
        color: #666;
    }

    /* Checkbox */
    .checkbox-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 15px;
    }

    /* Payment Button */
    .pay-btn {
        width: 100%;
        background: #0073FF;
        padding: 14px;
        color: #fff;
        font-size: 18px;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }

    .pay-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
</style>
</head>


<body>
    <div class="container">

        <h1 class="text-center">Checkout Page</h1>

        <div class="grid">
            <!-- LEFT SIDE -->
            <div>
                <div class="cart-list" id="checkoutCartList"></div>
                <h3 class="section-title">Delivery Address</h3>
                <div class="checkout-section form-row px-10">


                    <div class="form-group">
                        <input id="name" class="form-input" required>
                        <label for="name" class="form-label">Full Name</label>
                    </div>

                    <div class="form-group">
                        <input id="phone" class="form-input" required>
                        <label for="phone" class="form-label">Mobile Number</label>
                    </div>

                    <div class="form-group">
                        <input id="billing_pincode" class="form-input" required>
                        <label class="form-label">PIN Code</label>
                    </div>

                    <div class="form-group">
                        <input id="billing_city" class="form-input" required>
                        <label class="form-label">Town / City</label>
                    </div>

                    <div class="form-group">
                        <textarea id="address" class="form-input" rows="3" required></textarea>
                        <label for="address" class="form-label">Flat, House no., Building, Company</label>
                    </div>

                    <div class="form-group">
                        <textarea id="address" class="form-input" rows="3" required></textarea>
                        <label for="address" class="form-label">Area, Street, Sector, Village</label>
                    </div>

                    <div class="form-group" style="grid-column: span 2;">
                        <label class="form-label">Landmark (Optional)</label>
                        <input id="landmark" class="form-input">
                    </div>

                    <div class="form-group">
                        <input id="billing_email" class="form-input" required>
                        <label class="form-label">Email</label>
                    </div>


                    <div class="form-group">
                        <input id="billing_state" class="form-input" required>
                        <label class="form-label">State</label>
                    </div>



                    <div class="form-group">
                        <input id="billing_country" class="form-input" value="India" required>
                        <label class="form-label">Country</label>
                    </div>
                </div>

                <div class="checkout-container">

                    <!-- DELIVERY ADDRESS -->




                    <!-- BILLING DETAILS -->
                    <h2 class="section-title">2. Billing details</h2>
                    <div class="checkbox-row">
                        <input type="checkbox" id="sameBilling" checked onchange="copyBilling()">
                        <label for="sameBilling">Billing address same as delivery address</label>
                    </div>

                    <div id="billingSection">

                        <div class="form-row">

                            <div class="form-group">
                                <label class="form-label">Billing Name</label>
                                <input id="billing_name" class="form-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label">GST Number (Optional)</label>
                                <input id="billing_gst" class="form-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Billing Email</label>
                                <input id="billing_email" class="form-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Billing Phone</label>
                                <input id="billing_phone" class="form-input">
                            </div>

                            <div class="form-group" style="grid-column: span 2;">
                                <label class="form-label">Billing Address</label>
                                <input id="billing_address" class="form-input">
                            </div>

                        </div>
                    </div>

                    <!-- PAY BUTTON -->
                    <button id="payBtn" class="pay-btn" onclick="processPayment()">Proceed to Payment</button>

                </div>


            </div>

            <!-- RIGHT SIDE -->
            <aside class="side">

                <label><strong>GST</strong></label>
                <select id="gstSelect" class="form-control" onchange="updateTotals()">
                    <option value="0">No GST</option>
                    <option value="18">IGST 18%</option>
                    <option value="9_9">CGST 9% + SGST 9%</option>
                </select>

                <div class="total-row"><span>Subtotal</span><strong id="subtotal">₹0</strong></div>
                <div class="total-row"><span>GST</span><strong id="gstAmount">₹0</strong></div>
                <div class="total-row"><span>Shipping</span><strong id="shipping">₹0</strong></div>

                <div class="total-row" style="font-size:20px">
                    <span><b>Total</b></span>
                    <strong id="grandTotal">₹0</strong>
                </div>

                <button class="primary-btn"id="payBtn" class="pay-btn" onclick="processPayment()" style="margin-top:15px">Pay Now</button>
                <p style="font-size:13px;color:#777;margin-top:10px">
                    Payments are securely processed using PayU India.
                </p>
            </aside>
        </div>
    </div>


    <script>
        /* ============================================================
           LOAD CART FROM LOCAL STORAGE
        ============================================================ */
        let stored = JSON.parse(localStorage.getItem("checkoutCart") || "[]");

        const checkoutCartList = document.getElementById("checkoutCartList");
        const subtotalEl = document.getElementById("subtotal");
        const gstAmountEl = document.getElementById("gstAmount");
        const shippingEl = document.getElementById("shipping");
        const grandTotalEl = document.getElementById("grandTotal");
        const gstSelect = document.getElementById("gstSelect");
        const payBtn = document.getElementById("payBtn");

        let subtotal = 0;


        /* ============================================================
           RENDER ITEMS
        ============================================================ */
        function renderCheckoutItems() {
            checkoutCartList.innerHTML = "";
            subtotal = 0;

            if (!stored.length) {
                checkoutCartList.innerHTML = "<div>No items in cart.</div>";
                updateTotals();
                return;
            }

            stored.forEach((item, index) => {

                const imgSrc = item.image || item.img || "";

                const row = document.createElement("div");
                row.className = "cart-item";

                row.innerHTML = `
          <img src="${imgSrc}"
                style="width:90px;height:90px;object-fit:cover;border-radius:6px">
            <div style="flex:1">
                <b>${item.title}</b><br>
                  Quality: ${item.quality}<br>
                Sets: ${item.sets}<br>
                MOQ: ${item.moq} pcs<br>
                Total Pcs: ${item.totalPcs}
            </div>

            <strong>₹${item.price}</strong>

            <button class="removeBtn" data-index="${index}">✖</button>
        `;

                checkoutCartList.appendChild(row);
                subtotal += Number(item.price);
            });

            updateTotals();
        }


        /* ============================================================
           GST + TOTAL CALCULATION
        ============================================================ */
        function updateTotals() {
            subtotalEl.innerText = "₹" + subtotal;

            let gst = 0;
            const gstOption = gstSelect.value;

            if (gstOption === "18") gst = subtotal * 0.18;
            if (gstOption === "9_9") gst = subtotal * 0.18;

            gstAmountEl.innerText = "₹" + gst.toFixed(2);

            const shipping = subtotal > 0 ? 0 : 0;
            shippingEl.innerText = "₹" + shipping;

            grandTotalEl.innerText = "₹" + (subtotal + gst + shipping).toFixed(2);
        }

        renderCheckoutItems();


        /* ============================================================
           REMOVE ITEM
        ============================================================ */
        checkoutCartList.addEventListener("click", (e) => {
            if (!e.target.classList.contains("removeBtn")) return;

            const index = Number(e.target.dataset.index);
            stored.splice(index, 1);

            localStorage.setItem("checkoutCart", JSON.stringify(stored));
            renderCheckoutItems();
        });


        /* ============================================================
           PAYU HASH GENERATOR (SHA512)
        ============================================================ */
        async function generatePayUHash(key, txnid, amount, productinfo, firstname, email, salt) {
            const str = `${key}|${txnid}|${amount}|${productinfo}|${firstname}|${email}|||||||||||${salt}`;
            const buffer = new TextEncoder().encode(str);
            const hashBuffer = await crypto.subtle.digest("SHA-512", buffer);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, "0")).join("");
        }

        async function processPayment() {

            if (!stored.length) {
                alert("Your cart is empty");
                return;
            }

            let name = document.getElementById("name").value.trim();
            let phone = document.getElementById("phone").value.trim();
            let address = document.getElementById("address").value.trim();
            let email = document.getElementById("billing_email").value.trim();
            let city = document.getElementById("billing_city").value.trim();
            let state = document.getElementById("billing_state").value.trim();
            let pincode = document.getElementById("billing_pincode").value.trim();

            if (!name || !phone || !address || !email || !city || !state || !pincode) {
                alert("Please fill all shipping & billing details");
                return;
            }

            payBtn.disabled = true;
            payBtn.innerText = "Processing...";

            const totalAmount = Number(grandTotalEl.innerText.replace("₹", ""));
            const key = "EjKBQq";       // ✅ Your PayU Key
            const salt = "MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDY3Pv7uXln8Qc5QPirbdYXKk/AKeRfWUyU51ntrB9se8tEj+dhUWxjtqtQrQVw6lXZwypgGo+GDHJTrhlohcpLzs8ZRlXikh5HfBKfW1mDR1jKWjle2KYWj3wDAOkyCi0kdEci2tq4OQZS/oJrEXZ7NRe7WF/CiXmvm75oVBYeJxCd0kJjUB8zGt5USoMvbwkRMpku0ES5I+ZonxZRH5ufzOixjRXRtwrLd5EyVjEFDiqOajQ7k02vYybTlJzvnM6NSUVGfo5/pU/kRBrii+rUMwVGBkBPpv3mPYzJOGeAjniHIuTkjcjcC1FkOk+3lKcqIq0tl2wL2qaFxNOV/3e1AgMBAAECggEAdl+hmBT0xRzWwZTKZ+DLdNeespjrVHSNDdZ+yvIiMPgdyy31sbRdQsyKFL5s8uamt/gFIHI/F3+hxDWLHvewpdKcTwKKjOMPbhu2mo+le7gtKj83g6MkfboSih0sLSlK3NQvpEHsE5Tk89aC3+inULd5XcTueGTMLGQJ+i6z5/6POe2kyezGJxtHs3oWsIiL34J14Gdbd+hdtL7dV98z3j2Q1Jp/pgHBV7fOV13/3nJzdd1Olan/Bvx75y3om6nC/hZuoM5G0wOe/pC6T+SrUdmITP1VTKeLQRPGZmrdyA4dgmAhrgP5AcEoYtLKYDCNWa3EDvHLhC3qUmf0pA33PQKBgQD5YUAxES/ii30ptdIVPVrKhxSa1u/ARvdrLmKur/srmMNjY+OLGPQ7cPJVSa+oz7x+HllWAevbmW4Vl9emRZqJde5Khtj4W5ZuIDLqJ9WCa1/Cen3We4Aczb3Js5WBs7qRh9OU2iMLwHcwzyYP6dfRTZuOgtE3DWc84n7eFL+JqwKBgQDensFLLpsCPT/z/T3wvFWFQ6INSyp2smxyUTI8Mz1405SsVuQ2zAP43uU6MnxxzlpTfZtuWEdTRz7rowwBc5yW41kVylMZZf/pNtVsHyStP62Nuz2g8GCPJwEqMoRYpNi6j4vaoJX70dxu0H79fn9GCnonkk7hcfE1YXK/4hVkHwKBgBZ0UEBayNIAN1PjIDhzXtJvmUZb5hiNC0gmVBJgnCAP0EAJxXpH0+3qPJe7W8q6ccF1YBvjbmZGiWf+VReOmtyXts4VGEI8lO3zjkIRNiNZIbU0LFJ8qkttpxIbTnHwSfNCpKV5gsBTIyhM7qNuLdWVxFTvqIDpfws3Za7/dUOjAoGAfj9twuMlSPnPQOEGtXU40qBuUDemVzYMRjBB2t38KH9kuu9z8Jd2UTamrIBhDnFFzD9ZXBR4LoQi7KLEdjZIQVGg/biFs8uie3F7SxvGQvHvzIa5BoILYGNwR6vqXhLuTa6GU2/qXqq+5aEbw0pvhxr9918DmNpzPiCLYMIn+2UCgYAWYhoMlZYgGH8XFtiOKs+8LJ84NCMyNE81/8PVdmlHkPxePjr3pJqTyHipJ9F6tikuiAEyiAN8HMRNECKIfUDEIASaQEjeaJ6WiMCsc1j9yz1chUXIeprhqlopic+TqT/5Vd1ojipcOdrKY75vJS5Zmg/X4wgEpnrCbk9krYkeYw==";  // ✅ Your PayU Salt
            const txnid = "TXN" + Date.now();
            const productinfo = "Corrugated Box Order";

            const hash = await generatePayUHash(key, txnid, totalAmount, productinfo, name, email, salt);

            const form = document.createElement("form");
            form.method = "POST";
            form.action = "https://secure.payu.in/_payment";

            const fields = {
                key, txnid,
                amount: totalAmount,
                productinfo,
                firstname: name,
                email,
                phone,
                surl: "https://dynamiccorrugations.com/payment-success.html",
                furl: "https://dynamiccorrugations.com/payment-failure.html",
                hash
            };

            Object.entries(fields).forEach(([k, v]) => {
                let i = document.createElement("input");
                i.type = "hidden"; i.name = k; i.value = v;
                form.appendChild(i);
            });

            document.body.appendChild(form);
            form.submit();
        }

        payBtn.addEventListener("click", processPayment);

    </script>
    <script>
        setInterval(function () {
            const threshold = 160;
            if (window.outerWidth - window.innerWidth > threshold ||
                window.outerHeight - window.innerHeight > threshold) {
                window.location.href = "https://dynamiccorrugations.com";
            }
        }, 1000);
    </script>

</body>

</html>